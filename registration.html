<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="author" content="Ignazio Sotgiu">
    <meta name="keywords" content="trivia quiz game questions answers">
    <meta name="Trivia Quiz" content="trivia quiz game questions answers">
    <link rel="icon" href="assets/images/favicon.ico" sizes="16x16" type="image/ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/all.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <title>Title</title>

    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js">
    </script>
    <script type="text/javascript">
        (function(){
            emailjs.init("user_TwqrcVu3UXELwEaku5gRA");
            })();
    </script>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-hQpvDQiCJaD2H465dQfA717v7lu5qHWtDbWNPvaTJ0ID5xnPUlVXnKzq7b8YUkbN" crossorigin="anonymous">
  <link href="https://triviaquizusers-3a90.restdb.io/assets/css/jquery.datetimepicker.min.css" rel="stylesheet">
  <!--<style>
    .thank-you{
      font-size: 16px;
      padding: 20px;	
    }
    #trivia-users-form{
      padding: 10px;
    }
    #trivia-users-form input,  #trivia-users-form select{
      width: 300px;
    }
    label{
      display: block;
    }
    .form-control{
      width: auto;
    }
    .help-block{
      margin-left:10px;
    }
    .progress{
      width: 300px;
      height:10px;
      border-radius:0px;
      margin-top: 2px;
    }
    #btn-submit{
        width: 300px;
    }
  </style>-->

  <script src="https://code.jquery.com/jquery-2.2.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha256-KXn5puMvxCw+dAYznun+drMdG1IFl3agK0p/pqT9KAo= sha512-2e8qq0ETcfWRI4HJBzQiA3UoyFk6tbNyG+qSaIBZLyW9Xf3sWZHN/lxe9fTh1U45DpPf07yj94KsUHHWe4Yk1A==" crossorigin="anonymous"></script>
  <script src="https://triviaquizusers-3a90.restdb.io/assets/js/jquery-serialize-object.min.js"></script>
  <script src="https://triviaquizusers-3a90.restdb.io/assets/js/jquery.datetimepicker.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.5.1/lodash.min.js"></script>

  <link rel="stylesheet" href="assets/css/style.css">
</head>
<body>
    <div class="jumbotron">
    <!---------------------Header-------------------------->
    
    <div class="registration-header-container header-container-bg">
        <div id="registration-form-logo">
            <a href="index.html"><h3>Trivia<br>Quiz</h3><div id="reg-home-link">HOME</div></a>
        </div>
    </div>
    <!-----------------------Navigation------------------
    <div id="navigation-bar" class="container-fluid navbar-container">
        <nav class="navbar navbar-dark navbar-expand-sm">
            <a href="index.html" class="navbar-brand mx-auto"><span id="navbar-brand-text">Trivia<br>Quiz</span></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTriviaQuizDropdown" aria-controls="navbarTriviaQuizDropdown" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarTriviaQuizDropdown">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item nav-link"><i class="fas fa-moon" id="change-mode-icon"></i></li>
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" id="registration-link" data-open="registration-modal" data-toggle="registration-modal" data-backdrop="false" href="#">Register</a></li>
                    <li class="nav-item"><a class="nav-link" id="login-link" data-open="login-modal" data-toggle="login-modal" data-backdrop="false" href="#">Login</a></li>
                    <li class="nav-item"><a class="nav-link" id="contact-link" data-open="contact-modal" data-toggle="contact-modal" data-backdrop="false" href="#">Contact</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="leaderboards.html" id="navbarLeaderboardsDropdownLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-hidden="false">Leaderboards</a>
                        <div class="dropdown-menu" aria-labelledby="navbarLeaderboardsDropdownLink">
                            <a class="dropdown-item" href="database1.html">Top 10 Easy</a>
                            <a class="dropdown-item" href="top-ten-medium.html">Top 10 Medium</a>
                            <a class="dropdown-item" href="top-ten-hard.html">Top 10 Hard</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>
    </div>-->

    <!--<div class="" id="registration-form">
        <div class="jumbotron">
            <div class="register-form-container">
                <h4 class="registration-modal-header">Please register to Trivia Quiz.</h4>
                <form role="form" id="trivia-user-form">
                    <div class="row form-group">
                        <div class="registration-form-label col-12 col-md-6">
                            <label for="first-name">First Name</label>
                        </div>
                        <div class="registration-form-input col-12 col-md-6">
                            <input data-type="text" type="text" class="first-name-input form-control" id="first-name" name="first-name" placeholder="First Name">
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="registration-form-label col-12 col-md-6">
                            <label for="last-name">Last Name</label>
                        </div>
                        <div class="registration-form-input col12 col-md-6">
                            <input data-type="text" type="text" class="last-name-input form-control" id="last-name" name="last-name" placeholder="Last Name">
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="registration-form-label col-12 col-md-6">
                            <label for="username">Username</label>
                        </div>
                        <div class="registration-form-input col12 col-md-6">
                            <input data-type="text" type="text" class="username-input form-control" id="username" name="username" placeholder="Username">
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="registration-form-label col-12 col-md-6">
                            <label for="reg-email">Email Address</label>
                        </div>
                        <div class="registration-form-input col-12 col-md-6">
                            <input data-type="email" type="email" class="email-input form-control" id="reg-email" placeholder="email">
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="registration-form-label col-12 col-md-6">
                            <label for="reg-password">Enter Password</label>
                        </div>
                        <div class="registration-form-input col-12 col-md-6">
                            <input data-type="text" type="password" class="password form-control" id="reg-password" name="password" placeholder="password">
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="registration-form-label col-12 col-md-6">
                            <label for="password-2">Confirm Password</label>
                        </div>
                        <div class="registration-form-input col-12 col-md-6">
                            <input data-type="text" type="password" class="password form-control" id="password-2" name="confirm-password" placeholder="password">
                        </div>
                    </div>
                    <div class="form-group">
                        <input class="newsletter form-control" data-type="text" type="checkbox" id="reg-newsletter" name="newsletter" value="">
                        <label for="newsletter">yes, I would like to receive News and Updates</label>
                    </div>
                    <div class="row form-group">
                        <div class="modal-btn-container col-12">
                            <button id="registration-button" type="submit" class="btn btn-light form-control" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Submitting...">Submit</button>
                        </div>
                    </div>
                    <div class="row form-group">
                        <div class="modal-cancel col-12">
                            <a href="index.html">Cancel</a>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>-->

    <!--<div class="jumbotron">-->
        <div class="register-form-container">
            <h4 class="registration-modal-header">Please register to Trivia Quiz.</h4>
            <form role="form" id="trivia-users-form">
                <!--<div class="form-group">
                <label>First name: </label><input class="form-control" name="first-name" data-type="text" type="text">
                </div>-->
                <div class="row form-group">
                    <div class="registration-form-label col-12 col-md-6">
                        <label for="first-name">First Name</label>
                    </div>
                    <div class="registration-form-input col-12 col-md-6">
                        <input data-type="text" type="text" class="first-name-input" id="first-name" name="first-name" placeholder="First Name">
                    </div>
                </div>
                <!--<div class="form-group">
                <label>Last name: </label><input class="form-control" name="last-name" data-type="text" type="text">
                </div>-->
                <div class="row form-group">
                    <div class="registration-form-label col-12 col-md-6">
                        <label for="last-name">Last Name</label>
                    </div>
                    <div class="registration-form-input col12 col-md-6">
                        <input data-type="text" type="text" class="last-name-input" id="last-name" name="last-name" placeholder="Last Name">
                    </div>
                </div>
                <!--<div class="form-group">
                <label>Username: </label><input class="form-control" name="username" data-type="text" type="text">
                </div>-->
                <div class="row form-group">
                    <div class="registration-form-label col-12 col-md-6">
                        <label for="username">Username</label>
                    </div>
                    <div class="registration-form-input col12 col-md-6">
                        <input data-type="text" type="text" class="username-input" id="username" name="username" placeholder="Username">
                    </div>
                </div>
                <!--<div class="form-group">
                <label>Email: </label><input class="form-control" name="email" data-type="email" type="email">
                </div>-->
                <div class="row form-group">
                    <div class="registration-form-label col-12 col-md-6">
                        <label for="reg-email">Email Address</label>
                    </div>
                    <div class="registration-form-input col-12 col-md-6">
                        <input data-type="email" type="email" class="email-input" id="reg-email" name="email" placeholder="email">
                    </div>
                </div>
                <!--<div class="form-group">
                <label>Password: </label><input class="form-control" name="password" data-type="text" type="text">
                </div>-->
                <div class="row form-group">
                    <div class="registration-form-label col-12 col-md-6">
                        <label for="reg-password">Enter Password</label>
                    </div>
                    <div class="registration-form-input col-12 col-md-6">
                        <input data-type="password" type="password" class="password" id="reg-password" name="password" placeholder="password">
                    </div>
                </div>
                <!--<div class="form-group">
                <label>Confirm password: </label><input class="form-control" name="confirm-password" data-type="text" type="text" required>
                </div>-->
                <div class="row form-group">
                    <div class="registration-form-label col-12 col-md-6">
                        <label for="confirm-password">Confirm Password</label>
                    </div>
                    <div class="registration-form-input col-12 col-md-6">
                        <input data-type="password" type="password" class="password" id="confirm-password" name="confirm-password" placeholder="Confirm Password">
                    </div>
                </div>
                <!--<div class="form-group">
                <label>Newsletter: </label><input class="form-control" name="newsletter" data-type="bool" type="checkbox">
                </div>-->
                <div class="form-group">
                    <input class="newsletter" data-type="bool" type="checkbox" id="newsletter" name="newsletter">
                    <label for="newsletter">Yes, I would like to receive News and Updates</label>
                </div>


                <div id="fg-errors" class="form-group">
                </div>
                <button class="btn btn-primary btn-lg" id="btn-submit" type="submit" data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Submitting...">Submit</button>
            </form>
        </div>
    </div>
<script>
$(function () {

  // put your own error messages and/or message translation logic here

  var errorMessages = {
    "REQUIRED": "This field is required",
    "UNIQUE": "This value already exists",
    "TYPE": "Invalid data type",
    "REGEX":"Invalid data format",
    "number": "Must be an integer number",
    "money": "Must be a number with max two decimals",
    "JSON":"Not a valid JSON",
    "float_number":"Must be a decimal number",
    "email": "Must be a valid email",
    "FILESIZE": "Upload exceeds file size limit per field (max 1 MB)",
    "UPLOADERROR": "Unable to upload file, please try again",
    "GENERIC_ERROR": "A server error occured, please reload page"
  }

  var successMessage = "Thank you!";

  // enable javascript datetimepicker unless supported
  // Docs and settings: http://xdsoft.net/jqplugins/datetimepicker/

  $.datetimepicker.setLocale('en');

  // if missing support for datetime, then use jquery.datetimepicker

  if (!Modernizr.inputtypes.datetime){
      $("input[data-type=date]").datetimepicker({timepicker:false,format:"Y/m/d"}).attr("type","text");
      $("input[data-type=datetime]").datetimepicker({}).attr("type","text");
      $("input[data-type=time]").datetimepicker({datepicker:false,format:"H:i",value:"12:00"}).attr("type","text");
  }

  $("#trivia-users-form input[data-type=file], #trivia-users-form input[data-type=image]").on("change",function(){
    $(this).data("uploadedfiles",[]);    
  });
  var apikey = "a900238b95d6ee1f294acf91ff8619db141a1"; // TODO: INSERT YOUR CORS API KEY HERE OR add formapikey to settings
  
  if (!apikey) alert("Please insert a CORS API key");

  var ajaxSettings = {
    "async": true,
    "crossDomain": true,
    "url": "https://triviaquizusers-3a90.restdb.io/rest/trivia-users",
    "method": "POST",
    "headers": {
      "x-apikey": apikey,
      "content-type": "application/json"
    },
    "processData": false
  }

  var ajaxSettingsAttachments = {
     "async": true,
     "url": "https://triviaquizusers-3a90.restdb.io/media",
     "method": "POST",
     "contentType": false,
     "headers": {
       "x-apikey": apikey
     },
     "cache": false,
     "processData": false
   }



  function uploadAttachment(item){
    var deferred = $.Deferred();
    var datatype = $(item).attr("data-type");
    var element_name = $(item).attr("name");
    var formData = new FormData();
    var files = $(item)[0].files;
    var totalsize = 0;
    var files_to_upload = []
    _.each(files,function(file){
      // ignore non-images
      if(datatype==="image" && !file.type.match('image.*')){
        return;
      }else{
        files_to_upload.push(file);
        totalsize += file.size;        
      }
    });

    // check max upload file size for development plan
    if (totalsize<=1000000){
      _.each(files_to_upload,function(file){
        formData.append(element_name, file, file.name);
      });
      var asa = _.clone(ajaxSettingsAttachments);
      asa.xhr = function() {
        var xhr = new window.XMLHttpRequest();
        xhr.upload.addEventListener("progress", function(evt) {
          if (evt.lengthComputable) {
            var percentComplete = evt.loaded / evt.total;
            percentComplete = parseInt(percentComplete * 100)+"%";
            $("#"+element_name+"_progress")
            .css("width",percentComplete)
          }
        }, false);
        return xhr;
      }
      asa.data = formData;
      var uploadedbefore = $(item).data("uploaded");
      if (!uploadedbefore){
        $("#"+element_name+"_progress").parent().removeClass("hidden");
        $("#btn-submit").button("loading");
        $.ajax(asa)
        .success(function(data){
          var result = data.ids || [];
          var successObj = {};
          successObj[element_name] = result;
          $(item).data("uploaded",result);
          deferred.resolve(successObj);       
        })
        .fail(function(){
          deferred.reject({field: element_name, error: errorMessages.UPLOADERROR});
        });
      }else{
        var obj = {};
        obj[element_name]=uploadedbefore;
        deferred.resolve(obj);
      }
    }else{
      deferred.reject({field: element_name, error: errorMessages.FILESIZE});
    }
    return deferred.promise();
  }

  function postForm() {

    // clear errors
    $("#trivia-users-form .has-error").removeClass("has-error");
    $("#trivia-users-form .help-block").remove();

    $("#btn-submit").button("loading");

  // we need to reformat date, datetime, datetime-local and time to ISO date strings

    $("input[data-type=datetime],input[data-type=datetime-local]").each(function(){
        var theDate = $(this).val();
        if(theDate){
            var isodate_str = new Date(theDate).toISOString();
            $(this).val(isodate_str);   
        }
    });

    $("input[data-type=date]").each(function(){
      var theDate = $(this).val();
      if (theDate){
          theDate += " GMT";
          var isodate_str = new Date(theDate).toISOString();
          $(this).val(isodate_str);
      }
    });

     $("input[data-type=time]").each(function(){
        var timeval = $(this).val();
        if (timeval){
            var regex = /^([0-9]|0[0-9]|1[0-9]|2[0-3]):[0-5][0-9]$/
            if (timeval.match(regex)){
                var isodate_str = new Date("1970-01-01T"+$(this).val()+":00Z").toISOString();
                $(this).val(isodate_str);
            }   
        }
    });


 // get the form data
    var formObj = $("#trivia-users-form").serializeObject();

    // get attachments from inputs
    var attachments = [];

    $("#trivia-users-form input[data-type=file], #trivia-users-form input[data-type=image]").each(function(input){
      var files = $(this)[0].files;
      if(files && files.length>0){
        attachments.push($(this));
      }
    });

    var attachFuncs = [];
    _.each(attachments,function(attachment){
      attachFuncs.push(uploadAttachment(attachment));
    });
  
    // upload all attachments and return with ids when done
    $.when.apply(null,attachFuncs)
      .done(function(){
        // get the attachment id's from arguments and store into form obj

        _.each(arguments,function(fieldObj){
          formObj = _.assign(formObj,fieldObj);
        });

       // submit the whole form with attachment ids 

       ajaxSettings.data = JSON.stringify(formObj);
        $.ajax(ajaxSettings)
        .done(function (response) {
          // replaces form with a thank you message, please replace with your own functionality
          $("#trivia-users-form").replaceWith("<div class='thank-you'>"+successMessage+"</div>");
        })
        .fail(function (response) {
          $("#btn-submit").button("reset");
          var error = response.responseJSON;
          if (error && error.name==="ValidationError"){
            _.each(error.list,function(fielderr){
              var inputSelector = "[name="+fielderr.field+"]";
              var errorMessageCode = fielderr.message[1];
              var errorMessage = errorMessages[errorMessageCode] || "Invalid value";
              if (errorMessageCode==="TYPE"){
                var fieldType = $(inputSelector).data("type");
                errorMessage = errorMessages[fieldType] || "Invalid value";
              }
              $(inputSelector).after("<div class='help-block'>"+errorMessage+"</div>");
              $(inputSelector).parents(".form-group").addClass("has-error");
            });
          }
          else{
            var msg = (ajaxSettings.headers["x-apikey"] && ajaxSettings.headers["x-apikey"].length < 24) ? "Missing API-key": "Server Error";
            alert(msg);
          }
        });
      })
      .fail( function (response) {
        $("#btn-submit").button("reset");
        if (response.field && response.error){
          var inputSelector = "[name="+response.field+"]";
          $(inputSelector).after("<div class='help-block'>"+response.error+"</div>");
          $(inputSelector).parents(".form-group").addClass("has-error");
        }else{
          var errorMessage = errorMessages.GENERIC_ERROR || "Problem submitting form";
          $("#fg-errors").addClass("has-error")
          .append("<div class='help-block'>"+errorMessage+"</div>");
        }
      });
  };

  $("#trivia-users-form").submit(function (event) {
        postForm();
        event.preventDefault();
        return false;
    });
});
</script>  </body>
</html>